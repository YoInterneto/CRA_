
%Listas para cada uno de los tableros usados en el programa
bolsa([
    'A','A','A','A','A','A','A','A','A','A',
    'B','B','B','B','B','B','B','B','B','B',
    'V','V','V','V','V','V','V','V','V','V',
    'R','R','R','R','R','R','R','R','R','R',
    'N','N','N','N','N','N','N','N','N','N']).
patron([
    ['*','*','*','*','_'],
    ['*','*','*','_','_'],
    ['*','*','_','_','_'],
    ['*','_','_','_','_'],
    ['_','_','_','_','_']
    ]).
mosaico([
    ['a','n','r','v','b'],
    ['b','a','n','r','v'],
    ['v','b','a','n','r'],
    ['r','v','b','a','n'],
    ['n','r','v','b','a']
    ]).
centroMesa([]).
cementerio([]).
caja([]).
tablero1([]).
tablero2([]).
tableroJuego([]).


%Inicializacion de las listas que usaran en el programa
ini_bolsa(BolsaOut):-bolsa(Bolsa),random_permutation(Bolsa, BolsaOut).

ini_centroMesa(Centro):-centroMesa(Centro).

ini_mosaico(Mosaico):-mosaico(Mosaico).

ini_caja(Caja):-caja(Caja).

ini_patron(Patron):-patron(Patron).

ini_cementerio(Cementerio):-cementerio(Cementerio).

ini_factoria(BolsaIn,BolsaOut,FactOut):-
    nth0(0, BolsaIn, Ficha1, BolsaAux1),
    nth0(0, BolsaAux1, Ficha2, BolsaAux2),
    nth0(0, BolsaAux2, Ficha3, BolsaAux3),
    nth0(0, BolsaAux3, Ficha4, BolsaOut),
    FactOut=[Ficha1,Ficha2,Ficha3,Ficha4].

ini_factorias(NFact,BolsaIn,BolsaOut,FactAux,FactOut):-
    NFact > 0,
    ini_factoria(BolsaIn,BolsaAux,FactoriaX),
    Sublista = [FactoriaX],
    %append(FactAux,FactoriaX,FactAux2),
    NFactOut is (NFact - 1),
    ini_factorias(NFactOut,BolsaAux,BolsaOut,Sublista,FactOut).

ini_factorias(0,BolsaOut,BolsaOut,FactOut,FactOut).

ini_factorias_njug(NJug,BolsaIn,BolsaOut,FactsOut):-
    NFacts is (NJug * 2) + 1,
    ini_factorias(NFacts,BolsaIn,BolsaOut,[],FactsOut).



%Logica del programa
jugarAzul():-
    iniciar(2,4,Jugadores).

iniciar(Min,Max,Jugadores):-
    repeat,
    write('Introduce el numero de jugadores (2-4): '),

    read(Jugadores),
    ((Jugadores>=Min,Jugadores=<Max,!);
        writeln('Dato incorrecto, n jugadores entre 2 y 4.'),false),
        
    iniciar_juego(Jugadores).

iniciar_juego(Jugadores):-
    write('Tablero inicializado con '),write(Jugadores),writeln(' jugadores'),
    
    ini_bolsa(Bolsa),
    ini_factorias_njug(Jugadores,Bolsa,BolsaOut,ListaFactorias),
    ini_centroMesa(Centro),
    ini_patron(Patron),
    ini_caja(Caja),
    ini_mosaico(Mosaico),
    ini_cementerio(Cementerio),
    
    Tablero1 = [Caja,BolsaOut,ListaFactorias,Centro],
    Tablero2 = [Patron,Mosaico,Cementerio],
    Juego = [Tablero1,Tablero2],

    empezar_juego(Jugadores,Juego).

empezar_juego(Jugadores,Juego):-

    Juego=[Tablero1,Tablero2],
    Tablero1=[Caja,Bolsa,Factorias,Centro],
    Tablero2=[Patron,Mosaico,Cementerio],

    write('Turno del jugador '), writeln(Jugadores),
    
    write('Caja -> '), writeln(Caja),
    write('Bolsa -> '), writeln(Bolsa),
    write('Factorias -> '), writeln(Factorias),
    write('Centro -> '), writeln(Centro),
    write('Patron -> '), writeln(Patron),
    write('Mosaico -> '), writeln(Mosaico),
    write('Cementerio -> '), writeln(Cementerio),

    elegir_factoria(Centro,Factorias,NFactoriaOut).


elegir_factoria(Centro,Factorias,NFactoriaOut):-
    
    length(Factorias, Longitud),
    %imprimir_factorias(Factorias, 0, Longitud),

    C is Longitud + 1,
    write(C),write('(centro). '),write(Centro).

imprimir_factorias(Factorias,NFactoria,Longitud):-
    NFactoria < Longitud - 1,
    nth0(NFactoria, Factorias, FactoriaWrite, FactoriasOut),

    Num is NFactoria + 1,
    write(Num),write('. '),write(FactoriaWrite),

    imprimir_factorias(Factorias, Num, Longitud).

pedir_n_factoria(NFactoriaOut):-
    repeat,
    read(X).
